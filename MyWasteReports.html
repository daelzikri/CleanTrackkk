<!DOCTYPE html>
<html lang="id" class="scroll-smooth">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Laporan & Jelajah - CleanTrack</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <link
        href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#2A62C8",
                        "secondary": "#50E3C2",
                        "background-light": "#f8fafc",
                        "surface": "#ffffff",
                    },
                    fontFamily: {
                        "display": ["Public Sans", "sans-serif"],
                        "mono": ["Space Grotesk", "monospace"]
                    }
                }
            }
        }
    </script>

    <script src="user-utils.js"></script>
    <script src="user-header.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        /* Hide Scrollbar Global */
        ::-webkit-scrollbar {
            display: none;
        }

        html,
        body {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* Gradient Border Utility */
        .gradient-border-mask {
            position: relative;
            background: #fff;
            background-clip: padding-box;
            border: 2px solid transparent;
            border-radius: 1.5rem;
        }

        .gradient-border-mask::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
            background: linear-gradient(to right, #2A62C8, #50E3C2);
        }
    </style>
</head>

<body class="bg-background-light font-display text-slate-800 antialiased selection:bg-primary/20">

    <div id="app-header"></div>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-[calc(100vh-64px)]">

        <div class="flex flex-col lg:flex-row gap-8 items-start">

            <!-- SIDEBAR PROFILE (STICKY) -->
            <aside class="w-full lg:w-80 flex-shrink-0 lg:sticky lg:top-28 space-y-6" data-aos="fade-right">

                <!-- Profile Card -->
                <div
                    class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-xl shadow-slate-200/50 relative overflow-hidden group">
                    <!-- Background Decoration -->
                    <div class="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-primary/10 to-secondary/10">
                    </div>

                    <div class="relative z-10 flex flex-col items-center text-center mt-4">
                        <div class="p-1 rounded-full bg-white shadow-sm mb-3">
                            <img id="sidebar-avatar" src=""
                                class="w-20 h-20 rounded-full object-cover border-4 border-slate-50">
                        </div>
                        <h2 class="text-xl font-black text-slate-900 leading-tight mb-1" id="sidebar-name">User</h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span
                                class="px-3 py-1 rounded-full bg-slate-900 text-white text-[10px] font-bold uppercase tracking-wider"
                                id="level-current">Warga</span>
                            <span class="text-sm font-mono font-bold text-primary" id="sidebar-points">0 Pts</span>
                        </div>
                    </div>

                    <div
                        class="mt-6 pt-6 border-t border-slate-100 grid grid-cols-3 gap-2 text-center divide-x divide-slate-100">
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Total</p>
                            <p class="text-lg font-black text-slate-900" id="stat-total">0</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Proses</p>
                            <p class="text-lg font-black text-blue-600" id="stat-progress">0</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Selesai</p>
                            <p class="text-lg font-black text-green-600" id="stat-resolved">0</p>
                        </div>
                    </div>
                </div>

                <!-- Create Button (Mobile/Tablet Only Context) -->
                <a href="ReportNew.html"
                    class="block w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-center shadow-lg hover:bg-primary transition-all active:scale-95 flex items-center justify-center gap-2 lg:hidden">
                    <span class="material-symbols-outlined">add_a_photo</span> Buat Laporan Baru
                </a>

            </aside>

            <!-- MAIN FEED -->
            <div class="flex-1 w-full min-w-0" data-aos="fade-up">

                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                    <div>
                        <h1 class="text-3xl font-black tracking-tight text-slate-900">Feed Lingkungan</h1>
                        <p class="text-slate-500 font-medium">Update terkini kondisi kebersihan di sekitar Anda.</p>
                    </div>

                    <!-- Create Button (Desktop) -->
                    <a href="ReportNew.html"
                        class="hidden lg:flex items-center gap-2 bg-slate-900 hover:bg-primary text-white px-6 py-3 rounded-2xl font-bold shadow-xl shadow-primary/20 transition-all hover:-translate-y-1 active:translate-y-0">
                        <span class="material-symbols-outlined text-xl">add_a_photo</span>
                        <span>Lapor Baru</span>
                    </a>
                </div>

                <!-- TABS -->
                <div class="bg-white p-1.5 rounded-2xl border border-slate-200 inline-flex mb-8 shadow-sm">
                    <button onclick="switchViewMode('MINE')" id="tab-main-mine"
                        class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-white bg-slate-900 shadow-md">
                        Laporan Saya
                    </button>
                    <button onclick="switchViewMode('PUBLIC')" id="tab-main-public"
                        class="px-6 py-2.5 rounded-xl text-sm font-bold text-slate-500 hover:text-slate-900 hover:bg-slate-50 transition-all">
                        Jelajah Warga
                    </button>
                </div>

                <!-- FILTERS -->
                <div class="flex flex-wrap gap-2 mb-8" id="filter-container">
                    <button onclick="filterReports('All')" id="btn-all"
                        class="px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white border-slate-200 text-slate-600 hover:border-slate-300">Semua</button>
                    <button onclick="filterReports('Pending')" id="btn-pending"
                        class="px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white border-slate-200 text-slate-600 hover:border-slate-300">Menunggu</button>
                    <button onclick="filterReports('In Progress')" id="btn-in-progress"
                        class="px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white border-slate-200 text-slate-600 hover:border-slate-300">Diproses</button>
                    <button onclick="filterReports('Resolved')" id="btn-resolved"
                        class="px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white border-slate-200 text-slate-600 hover:border-slate-300">Selesai</button>
                    <button onclick="filterReports('Rejected')" id="btn-rejected"
                        class="px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white border-slate-200 text-slate-600 hover:border-slate-300">Ditolak</button>
                </div>

                <!-- FEED LIST -->
                <div id="reports-list" class="space-y-8"></div>

                <!-- EMPTY STATE -->
                <div id="empty-state" class="hidden py-20 text-center">
                    <div
                        class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                        <span class="material-symbols-outlined text-4xl text-slate-300">search_off</span>
                    </div>
                    <h3 class="text-xl font-bold text-slate-900">Belum ada laporan</h3>
                    <p class="text-slate-500">Jadilah yang pertama melapor untuk area ini.</p>
                </div>

            </div>
        </div>
    </main>

    <!-- MAP MODAL -->
    <div id="map-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-md transition-opacity" onclick="closeMapModal()">
        </div>
        <div
            class="absolute inset-4 md:inset-10 bg-white rounded-[2rem] shadow-2xl overflow-hidden flex flex-col transform transition-all scale-100">
            <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-white z-10">
                <div>
                    <h3 class="font-bold text-slate-900 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">map</span> Peta Detail
                    </h3>
                    <p class="text-xs text-slate-500 font-mono" id="modal-map-address">...</p>
                </div>
                <button onclick="closeMapModal()"
                    class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 hover:bg-slate-100 text-slate-600 transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="flex-1 relative bg-slate-100">
                <div id="full-map" class="w-full h-full z-0"></div>
            </div>
        </div>
    </div>

    <!-- RATING MODAL -->
    <div id="rating-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeRatingModal()"></div>
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-sm p-8 relative z-10 transform scale-95 transition-all duration-300"
            id="rating-content">
            <div class="text-center">
                <div
                    class="w-16 h-16 bg-yellow-50 rounded-full flex items-center justify-center mx-auto mb-4 text-yellow-500">
                    <span class="material-symbols-outlined text-3xl">star</span>
                </div>
                <h3 class="text-xl font-black text-slate-900 mb-2">Beri Penilaian</h3>
                <p class="text-sm text-slate-500 mb-6">Seberapa puas Anda dengan penanganan laporan ini?</p>

                <div class="flex justify-center gap-2 mb-6">
                    <button class="star-btn text-slate-200 hover:text-yellow-400 transition-colors text-4xl"
                        data-value="1">★</button>
                    <button class="star-btn text-slate-200 hover:text-yellow-400 transition-colors text-4xl"
                        data-value="2">★</button>
                    <button class="star-btn text-slate-200 hover:text-yellow-400 transition-colors text-4xl"
                        data-value="3">★</button>
                    <button class="star-btn text-slate-200 hover:text-yellow-400 transition-colors text-4xl"
                        data-value="4">★</button>
                    <button class="star-btn text-slate-200 hover:text-yellow-400 transition-colors text-4xl"
                        data-value="5">★</button>
                </div>

                <textarea id="rating-comment" rows="3"
                    class="w-full p-4 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary text-sm mb-4 font-medium"
                    placeholder="Tulis ulasan singkat (opsional)..."></textarea>

                <div class="flex gap-2">
                    <button onclick="closeRatingModal()"
                        class="flex-1 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-50">Batal</button>
                    <button onclick="submitRating()"
                        class="flex-1 py-3 rounded-xl bg-slate-900 text-white font-bold hover:bg-primary shadow-lg">Kirim</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        AOS.init();

        let currentUser = null;
        let activeData = [];
        let viewMode = 'MINE';
        let currentFilterStatus = 'All';
        let ratingTargetId = null;
        let selectedStars = 0;
        let mapInstance = null;

        document.addEventListener('DOMContentLoaded', () => {
            currentUser = requireLogin();
            renderHeader('reports');
            loadData();
            window.addEventListener('storageUpdated', loadData);

            document.querySelectorAll('.star-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectedStars = parseInt(e.target.dataset.value);
                    updateStarUI(selectedStars);
                });
            });
        });

        // --- DATA LOGIC ---
        function loadData() {
            const allReports = getSharedReports();
            if (viewMode === 'MINE') {
                activeData = allReports.filter(r => r.userId === currentUser.id);
            } else {
                activeData = allReports.filter(r => r.userId !== currentUser.id && (r.status === 'Resolved' || r.status === 'Rejected'));
            }
            updateSidebar(allReports.filter(r => r.userId === currentUser.id));
            filterReports(currentFilterStatus);
        }

        function switchViewMode(mode) {
            viewMode = mode;
            const btnMine = document.getElementById('tab-main-mine');
            const btnPublic = document.getElementById('tab-main-public');

            if (mode === 'MINE') {
                btnMine.className = "px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-white bg-slate-900 shadow-md";
                btnPublic.className = "px-6 py-2.5 rounded-xl text-sm font-bold text-slate-500 hover:text-slate-900 hover:bg-slate-50 transition-all";
                document.getElementById('filter-container').classList.remove('hidden');
            } else {
                btnPublic.className = "px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-white bg-slate-900 shadow-md";
                btnMine.className = "px-6 py-2.5 rounded-xl text-sm font-bold text-slate-500 hover:text-slate-900 hover:bg-slate-50 transition-all";
                filterReports('All');
            }
            loadData();
        }

        function updateSidebar(myReports) {
            const allUsers = getSharedUsers();
            const freshUser = allUsers.find(u => u.id === currentUser.id) || currentUser;

            document.getElementById('sidebar-name').textContent = freshUser.name;
            document.getElementById('sidebar-points').textContent = (freshUser.points || 0) + " Pts";
            document.getElementById('sidebar-avatar').src = freshUser.avatar;

            document.getElementById('stat-total').textContent = myReports.length;
            document.getElementById('stat-progress').textContent = myReports.filter(r => r.status === 'In Progress').length;
            document.getElementById('stat-resolved').textContent = myReports.filter(r => r.status === 'Resolved').length;
        }

        function filterReports(status) {
            currentFilterStatus = status;
            updateFilterButtonsUI(status);
            const filtered = status === 'All' ? activeData : activeData.filter(r => r.status === status);
            renderList(filtered);
        }

        function updateFilterButtonsUI(activeStatus) {
            const statuses = ['All', 'Pending', 'In Progress', 'Resolved', 'Rejected'];
            statuses.forEach(st => {
                const btn = document.getElementById(`btn-${st.toLowerCase().replace(' ', '-')}`);
                if (!btn) return;

                if (st === activeStatus) {
                    btn.classList.add('bg-primary', 'text-white', 'border-primary');
                    btn.classList.remove('bg-white', 'text-slate-600', 'border-slate-200');
                } else {
                    btn.classList.remove('bg-primary', 'text-white', 'border-primary');
                    btn.classList.add('bg-white', 'text-slate-600', 'border-slate-200');
                }
            });
        }

        // --- RENDER FEED CARDS (AESTHETIC STYLE) ---
        function renderList(reports) {
            const container = document.getElementById('reports-list');
            const emptyState = document.getElementById('empty-state');
            container.innerHTML = '';

            if (reports.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            container.classList.remove('hidden');
            emptyState.classList.add('hidden');

            reports.forEach(report => {
                const isOwner = report.userId === currentUser.id;
                const statusData = getStatusData(report.status);

                // Get Avatar from shared users to ensure up-to-date picture
                const allUsers = getSharedUsers();
                const author = allUsers.find(u => u.id === report.userId);
                const avatarUrl = author ? author.avatar : `https://ui-avatars.com/api/?name=${report.reporterName}`;

                // Action Button Logic
                let actionBtn = '';
                if (isOwner && report.status === 'Resolved' && !report.rating) {
                    actionBtn = `
                        <button onclick="openRatingModal('${report.id}')" class="px-4 py-2 bg-yellow-400 hover:bg-yellow-500 text-white text-xs font-bold rounded-full shadow-lg shadow-yellow-200 transition-transform hover:scale-105 flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">star</span> Beri Nilai
                        </button>`;
                }

                // Feedback Content
                let feedbackHTML = '';
                if (report.status === 'Rejected' && report.adminNotes) {
                    feedbackHTML = `
                        <div class="mt-4 p-4 rounded-2xl bg-red-50 border border-red-100 flex items-start gap-3">
                            <span class="material-symbols-outlined text-red-500 mt-0.5">error</span>
                            <div>
                                <p class="text-xs font-bold text-red-800 uppercase mb-1">Laporan Ditolak</p>
                                <p class="text-sm text-red-600 leading-snug">"${report.adminNotes}"</p>
                            </div>
                        </div>`;
                } else if (report.status === 'Resolved' && report.reviewContent) {
                    const stars = '★'.repeat(report.rating);
                    feedbackHTML = `
                        <div class="mt-4 p-4 rounded-2xl bg-yellow-50 border border-yellow-100 flex items-start gap-3">
                            <span class="material-symbols-outlined text-yellow-600 mt-0.5">star</span>
                            <div>
                                <p class="text-xs font-bold text-yellow-800 uppercase mb-1">Ulasan Anda <span class="text-yellow-500 ml-1">${stars}</span></p>
                                <p class="text-sm text-yellow-700 leading-snug italic">"${report.reviewContent}"</p>
                            </div>
                        </div>`;
                }

                // HTML TEMPLATE
                const html = `
                <div class="bg-white rounded-[2.5rem] p-5 shadow-[0_20px_50px_-12px_rgba(0,0,0,0.05)] border border-slate-100 relative overflow-hidden group transition-all hover:shadow-[0_20px_50px_-12px_rgba(42,98,200,0.1)]" data-aos="fade-up">
                    
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-5 px-1">
                        <div class="flex items-center gap-3">
                            <div class="p-0.5 bg-gradient-to-tr from-primary to-secondary rounded-full">
                                <div class="bg-white p-0.5 rounded-full">
                                    <img src="${avatarUrl}" class="w-10 h-10 rounded-full object-cover">
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-900 text-sm leading-tight">${report.reporterName}</h4>
                                <p class="text-[10px] text-slate-400 font-mono mt-0.5">${report.date} • #${report.id}</p>
                            </div>
                        </div>
                        ${actionBtn}
                    </div>

                    <!-- Visual Grid (Desktop: Split, Mobile: Stack) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-5">
                        
                        <!-- Main Photo (2 Cols) -->
                        <div class="md:col-span-2 relative h-64 md:h-72 rounded-[2rem] overflow-hidden group-image shadow-inner bg-slate-100">
                            <img src="${report.photos[0]}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"></div>
                            
                            <!-- Glass Badge -->
                            <div class="absolute top-4 left-4">
                                <div class="px-3 py-1.5 rounded-full bg-white/20 backdrop-blur-md border border-white/30 shadow-lg flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full ${statusData.dotColor} animate-pulse"></span>
                                    <span class="text-xs font-black text-white tracking-wide uppercase drop-shadow-md">${report.status}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Map Integration (1 Col) - Gradient Border -->
                        <div class="relative h-32 md:h-72 rounded-[2rem] p-[2px] bg-gradient-to-br from-primary via-secondary to-blue-300 shadow-sm cursor-pointer hover:scale-[1.02] transition-transform" onclick="openMapModal('${report.id}', '${report.location.replace(/'/g, "\\'")}')">
                            <div class="w-full h-full bg-white rounded-[calc(2rem-2px)] overflow-hidden relative">
                                <img src="https://images.unsplash.com/photo-1524661135-423995f22d0b?q=80&w=400&fit=crop" class="w-full h-full object-cover opacity-60 hover:opacity-80 transition-opacity">
                                
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center shadow-lg text-primary animate-bounce">
                                        <span class="material-symbols-outlined text-2xl">location_on</span>
                                    </div>
                                </div>
                                
                                <div class="absolute bottom-0 left-0 right-0 p-3 bg-white/90 backdrop-blur text-center border-t border-slate-100">
                                    <p class="text-[10px] font-bold text-slate-600 truncate">${report.location}</p>
                                    <p class="text-[9px] text-primary font-bold mt-0.5">Tap untuk Peta Detail</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="px-2">
                        <p class="text-sm text-slate-600 leading-relaxed">
                            <span class="font-bold text-slate-900 mr-1">Laporan:</span> 
                            ${report.description}
                        </p>
                        ${feedbackHTML}
                    </div>

                </div>`;

                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function getStatusData(status) {
            if (status === 'Resolved') return { dotColor: 'bg-green-400' };
            if (status === 'In Progress') return { dotColor: 'bg-blue-400' };
            if (status === 'Rejected') return { dotColor: 'bg-red-500' };
            return { dotColor: 'bg-yellow-400' };
        }

        // --- MAP MODAL ---
        function openMapModal(id, locationStr) {
            const modal = document.getElementById('map-modal');
            document.getElementById('modal-map-address').textContent = locationStr;
            modal.classList.remove('hidden');

            if (mapInstance) {
                mapInstance.remove();
                mapInstance = null;
            }

            const coords = generateCoordinates(locationStr);
            setTimeout(() => {
                mapInstance = L.map('full-map').setView(coords, 16);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(mapInstance);
                L.marker(coords).addTo(mapInstance).bindPopup(`<b class="font-sans text-sm">${locationStr}</b>`).openPopup();
                mapInstance.invalidateSize();
            }, 100);
        }

        function closeMapModal() { document.getElementById('map-modal').classList.add('hidden'); }

        function generateCoordinates(str) {
            let hash = 0;
            const DEFAULT_CENTER = [-8.5833, 116.1167];
            for (let i = 0; i < str.length; i++) hash = ((hash << 5) - hash) + str.charCodeAt(i);
            const offsetLat = (hash % 1000) / 25000;
            const offsetLng = ((hash * 2) % 1000) / 25000;
            return [DEFAULT_CENTER[0] + offsetLat, DEFAULT_CENTER[1] + offsetLng];
        }

        // --- RATING ---
        function openRatingModal(id) {
            ratingTargetId = id;
            selectedStars = 0;
            updateStarUI(0);
            document.getElementById('rating-comment').value = "";
            const modal = document.getElementById('rating-modal');
            modal.classList.remove('hidden');
            setTimeout(() => document.getElementById('rating-content').classList.remove('scale-95'), 10);
        }

        function closeRatingModal() {
            const modal = document.getElementById('rating-modal');
            document.getElementById('rating-content').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function updateStarUI(rating) {
            document.querySelectorAll('.star-btn').forEach(btn => {
                const val = parseInt(btn.dataset.value);
                if (val <= rating) {
                    btn.classList.remove('text-slate-200'); btn.classList.add('text-yellow-400');
                } else {
                    btn.classList.add('text-slate-200'); btn.classList.remove('text-yellow-400');
                }
            });
        }

        function submitRating() {
            if (selectedStars === 0) return alert("Pilih bintang dulu!");
            const comment = document.getElementById('rating-comment').value.trim();
            const allReports = getSharedReports();
            const idx = allReports.findIndex(r => r.id === ratingTargetId);
            if (idx !== -1) {
                allReports[idx].rating = selectedStars;
                if (comment) allReports[idx].reviewContent = comment;
                saveSharedReports(allReports);
                closeRatingModal();
                loadData();
            }
        }
    </script>
</body>

</html>